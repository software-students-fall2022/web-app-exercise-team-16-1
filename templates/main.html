{% extends 'base.html' %}

{% block container %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    <h2>Shopping List</h2>
    <div class = "row">
        <div class = "col-2">
            <form action="{{ url_for('create', family_code=family_code)}}">
                <button class="btn btn btn-success" type="submit" id="button-add">Add</button>
            </form>
        </div>
        <div class = "col-10">
            <form action="{{ url_for('search', family_code = family_code)}}" method="post">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" name="search" placeholder="Item's name">
                    <button class="btn btn-outline-secondary" type="submit" id="search-button">Search</button>
                </div>
            </form>
        </div>
    </div>
    <div id="checkbox-container">
        <section class="itemsToBuy">
            {% for doc in docs %}
            <div class="card" style="width: 22rem;">
                <div class="card-body">
                    <h5 class="card-title">{{ doc.name }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">Quantity: {{ doc.quantity }}</h6>
                    <p class="card-text">Urgency: {{ doc.urgency }}</p>
                    <p class="card-text">Location: {{ doc.location }}</p>
                    <p>
                        <div>
                            <label for="option1">Item Bought:</label>
                            <input type="checkbox" id={{doc.name}}>
                        </div>
                    </p>
                    <a href="{{ url_for('edit', mongoid=doc._id, family_code = family_code) }}" class="card-link">Edit</a>
                    <a href="{{ url_for('delete', mongoid=doc._id, family_code = family_code) }}" class="card-link">Delete</a>
                </div>
            </div>
            {%endfor%}

        </section>
    </div>

    <script>
        var formValues = JSON.parse(localStorage.getItem('formValues')) || {};
          var $checkboxes = $("#checkbox-container :checkbox");
          var $button = $("#checkbox-container button");
          
          function allChecked(){
            return $checkboxes.length === $checkboxes.filter(":checked").length;
          }
          
          function updateButtonStatus(){
            $button.text(allChecked()? "Uncheck all" : "Check all");
          }
          
          function handleButtonClick(){
            $checkboxes.prop("checked", allChecked()? false : true)
          }
          
          function updateStorage(){
            $checkboxes.each(function(){
              formValues[this.id] = this.checked;
            });
          
            formValues["buttonText"] = $button.text();
            localStorage.setItem("formValues", JSON.stringify(formValues));
          }
          
          $button.on("click", function() {
            console.log("hi");
            handleButtonClick();
            updateButtonStatus();
            updateStorage();
          });
          
          $checkboxes.on("change", function(){
            updateButtonStatus();
            updateStorage();
          });
          
          // On page load
          $.each(formValues, function(key, value) {
            console.log("hello");
            $("#" + key).prop('checked', value);
          });
          
          $button.text(formValues["buttonText"]);
          </script>

{% endblock %}